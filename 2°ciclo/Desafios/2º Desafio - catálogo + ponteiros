#include <stdio.h>
#include<stdlib.h>
#include <locale.h>

struct dados{
    char nome[21];
    int quantidade;
    float preco;
    int mes;
    int ano;
};

int Menu() {
    int Resposta;
    printf("**--------------- Bem vindo ao menu do nosso catálogo de filmes ---------------**\n\n");
    printf("1 - Entrada de dados do filme\n");
    printf("2 - Lista todos os dados na tela\n");
    printf("3 - Pesquisa um filme pelo nome completo e mostra todos os dados na tela\n");
    printf("4 - Pesquisar data de lançamento do filme (mês/ano)\n");
    printf("5 - Listar filmes por faixa de preço.\n");
    printf("6 - Altera quantidade em estoque (entrada e saída).\n");
    printf("7 - Altera preço de um filme pesquisado pelo nome completo\n");
    printf("8 - Altera todos os dados do filme pesquisado pelo nome completo\n");
    printf("9 - Exclui filme pesquisado pelo nome completo\n");
    printf("10 - Saída\n");
    printf("\nDigite a opção que deseja: ");
    scanf("%d",&Resposta);
    getchar();
    system("cls");
    return Resposta;
}

void Entrada(FILE *catalogo, struct dados filme){

    catalogo = fopen("catalogo.txt", "a"); // para apenas adicionar
    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{

        printf("Digite o nome do filme: ");
        scanf("%s",&filme.nome);

        printf("Digite a quantidade disponivel: ");
        scanf("%d",&filme.quantidade);
        getchar();

        printf("Digite o preço do filme: ");
        scanf("%f",&filme.preco);

        printf("Digite o mês de laçamento: ");
        scanf("%d",&filme.mes);

        printf("Digite o ano de laçamento: ");
        scanf("%d",&filme.ano);
        //fprintf(catalogo,"%s %d %f %d %d",filme.nome, filme.quantidade,filme.preco,filme.mes,filme.ano);
        fwrite(&filme, sizeof(filme),1,catalogo);

    fclose(catalogo);
    printf("Filme cadastrado com sucesso!!!");
    }
}

void Listagem(FILE *catalogo, struct dados filme) {
    catalogo = fopen("catalogo.txt", "r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{
        while(fread(&filme, sizeof(filme),1,catalogo) == 1){
            printf("Nome do filme: %s\n",filme.nome);
            printf("Quantidade disponível: %d",filme.quantidade);
            printf("\nPreço: %.2f\n",filme.preco);
            printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
        }
    fclose(catalogo);
    }
}

int Pesquisa(FILE *catalogo, struct dados filme) {
    char pesquisa[21];
    int x;

    catalogo = fopen("catalogo.txt","r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{
        printf("Digite o nome do filme pesquisado: ");
        scanf("%s",&pesquisa);
        while(fread(&filme,sizeof(filme),1,catalogo)== 1){
            for(x = 0; pesquisa[x] != '\0'; x++)
                if(filme.nome[x]!= pesquisa[x])
                    break;
            if(filme.nome[x]== '\0' && pesquisa[x] == '\0') {
                printf("Nome do filme: %s\n",filme.nome);
                printf("Quantidade disponível: %d",filme.quantidade);
            printf("\nPreço: %.2f\n",filme.preco);
            printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
            }
        }
    }
    fclose(catalogo);
}
void Estoque(FILE *catalogo, struct dados filme) {
}

void ALteraPreco(FILE *catalogo, struct dados filme) {
}

void AlteraTudo(FILE *catalogo, struct dados filme){
}

void ExluiFilme(FILE *catalogo, struct dados filme){

}
void Saida() {
    printf("Fechando o menu...\n\n");
    exit(0);
}
int main(){
    int Resposta;
    struct dados filme;
    FILE *catalogo;
    setlocale(LC_ALL,"");

    for(;;) {
        system("cls");
        switch(Menu()) {
            case 1:
                Entrada(catalogo, filme);
            break;

            case 2:
                Listagem(catalogo, filme);
            break;

            case 3:
                Pesquisa(catalogo, filme);
            break;

            case 10:
                Saida();
            break;
        }
        system("pause");
    }
    return 0;
}
