#include <stdio.h>
#include<stdlib.h>
#include <locale.h>

struct dados{
    char nome[21];
    int quantidade;
    float preco;
    int mes;
    int ano;
};

int Menu() {
    int Resposta;
    printf("**--------------- Bem vindo ao menu do nosso catálogo de filmes ---------------**\n\n");
    printf("1 - Entrada de dados do filme\n");
    printf("2 - Lista todos os dados na tela\n");
    printf("3 - Pesquisa um filme pelo nome completo e mostra todos os dados na tela\n");
    printf("4 - Pesquisar data de lançamento do filme (mês/ano)\n");
    printf("5 - Listar filmes por faixa de preço.\n");
    printf("6 - Altera quantidade em estoque (entrada e saída).\n");
    printf("7 - Altera preço de um filme pesquisado pelo nome completo\n");
    printf("8 - Altera todos os dados do filme pesquisado pelo nome completo\n");
    printf("9 - Exclui filme pesquisado pelo nome completo\n");
    printf("10 - Saída\n");
    printf("\nDigite a opção que deseja: ");
    scanf("%d",&Resposta);
    getchar();
    system("cls");
    return Resposta;
}

void Entrada(FILE *catalogo, struct dados filme, char *filmepesquisado){

    catalogo = fopen("catalogo.txt", "a"); // para apenas adicionar
    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{

        printf("Digite o nome do filme: ");
        scanf("%s",&filme.nome);

        printf("Digite a quantidade disponivel: ");
        scanf("%d",&filme.quantidade);
        getchar();

        printf("Digite o preço do filme: ");
        scanf("%f",&filme.preco);

        printf("Digite o mês de laçamento: ");
        scanf("%d",&filme.mes);

        printf("Digite o ano de laçamento: ");
        scanf("%d",&filme.ano);
        //fprintf(catalogo,"%s %d %f %d %d",filme.nome, filme.quantidade,filme.preco,filme.mes,filme.ano);
        fwrite(&filme, sizeof(filme),1,catalogo);

    fclose(catalogo);
    printf("Filme cadastrado com sucesso!!!");
    }
}

void Listagem(FILE *catalogo, struct dados filme) {
    catalogo = fopen("catalogo.txt", "r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{
        while(fread(&filme, sizeof(filme),1,catalogo) == 1){
            printf("Nome do filme: %s\n",filme.nome);
            printf("Quantidade disponível: %d",filme.quantidade);
            printf("\nPreço: %.2f\n",filme.preco);
            printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
        }
    fclose(catalogo);
    }
}

int Pesquisa(FILE *catalogo, struct dados filme, char *filmepesquisado) {
    int x, pont = 0;

    catalogo = fopen("catalogo.txt","r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }
    else{
        while(fread(&filme,sizeof(filme),1,catalogo)== 1){
            for(x = 0; filmepesquisado[x] != '\0'; x++) {
                pont++;
                if(filme.nome[x]!= filmepesquisado[x])
                    break;
            }
            if(filme.nome[x]== '\0' && filmepesquisado[x] == '\0') {
                printf("Nome do filme: %s\n",filme.nome);
                printf("Quantidade disponível: %d",filme.quantidade);
                printf("\nPreço: %.2f\n",filme.preco);
                printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
            }
        }
    }
    fclose(catalogo);
    return pont;
}

void PesquisaData(FILE *catalogo, struct dados filme) {
    int ano, mes;

    catalogo = fopen("catalogo.txt","r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }

    else{
        printf("Insira o ano de lançamento do filme: ");
        scanf("%d",&ano);
        getchar();

        printf("Insira o mês de lançamento do filme: ");
        scanf("%d",&mes);
        getchar();

        while(fread(&filme,sizeof(filme),1,catalogo)== 1){
            if(ano == filme.ano && mes == filme.mes) {
                printf("\nNome do filme: %s\n",filme.nome);
                printf("Quantidade disponível: %d",filme.quantidade);
                printf("\nPreço: %.2f\n",filme.preco);
                printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
            }
        }
    }
    fclose(catalogo);
}

void FaixaPreco(FILE *catalogo, struct dados filme) {
   float min, max;

    catalogo = fopen("catalogo.txt","r");

    if(catalogo == NULL){
        printf("Não foi possível abrir o catálogo");
        return;
    }

    else{
        printf("Insira o preço mínimo: ");
        scanf("%f",&min);
        getchar();

        printf("Insira o preço máximo: ");
        scanf("%f",&max);
        getchar();

        while(fread(&filme,sizeof(filme),1,catalogo)== 1){
            if(filme.preco > min && filme.preco < max) {
                printf("\nNome do filme: %s\n",filme.nome);
                printf("Quantidade disponível: %d",filme.quantidade);
                printf("\nPreço: %.2f\n",filme.preco);
                printf("Data de lançamento: %d/%d\n\n",filme.mes, filme.ano);
            }
        }
    }
    fclose(catalogo);
}

void AlteraEstoque(FILE *catalogo, struct dados filme, char *filmepesquisado){
Pesquisa(catalogo, filme, filmepesquisado);
}
void ALteraPreco(FILE *catalogo, struct dados filme) {
}

void AlteraTudo(FILE *catalogo, struct dados filme){
}

void ExluiFilme(FILE *catalogo, struct dados filme){

}
void Saida() {
    printf("Fechando o menu...\n\n");
    exit(0);
}
int main(){
    int Resposta;
    struct dados filme;
    char filmepesquisado[21];
    FILE *catalogo;
    setlocale(LC_ALL,"");

    for(;;) {
        system("cls");
        switch(Menu()) {
            case 1:
                printf("Insira o nome do filme: ");
                gets(filmepesquisado);
                Entrada(catalogo, filme, filmepesquisado);
            break;

            case 2:
                Listagem(catalogo, filme);
            break;

            case 3:
                printf("Insira o nome do filme que deseja consultar: ");
                gets(filmepesquisado);
                Pesquisa(catalogo, filme,filmepesquisado);
            break;

            case 4:
                PesquisaData(catalogo, filme);
            break;

            case 5:
                FaixaPreco(catalogo, filme);
            break;

            case 6:
                AlteraEstoque();
            break;

            case 7:

            break;

            case 8:

            break;

            case 9:

            break;
            case 10:
                Saida();
            break;
        }
        system("pause");
    }
    return 0;
}
